This is the older version of the code.
